---
title:  "쿠버네티스 인 액션 정리: Ch06 컨피그맵과 시크릿"
toc: true
toc_sticky: true
categories:
  - Docker
  - kubernetes
use_math: true
last_modified_at: 2023-03-28
---

## 개요

다루는 내용:
- 컨테이너 주 프로세스 변경
- 애플리케이션에 명령줄 옵션 전달
- 애플리케이션에 노출되는 환경변수 설정
- 컨피그맵으로 애플리케이션 설정
- 시크릿을 통한 민감한 정보 전달

## 1. 컨테이너화된 애플리케이션 설정

- 일반적으로는 명령줄 인수로 애플리케이션에 필요한 설정을 넘겨줌
- 혹은 환경변수를 이용
  - 설정 파일을 이미지에 포함하거나 볼륨을 마운트해야 되기 때문에 컨테이너 내부 설정 파일을 사용하는 것이 까다롭기 때문
    - 이미지 포함할 경우 이미지에 접근이 가능하다면 누구나 볼 수 있기 때문에 소스 코드에 설정을 넣고 하드코딩하는거나 마찬
- 가장 좋은 방법은 k8s에서 설정 데이터를 저장하는 리소스인 컨피그맵(ConfigMap)을 사용하는 것
- 컨피그맵을 사용하면 다음 방법을 통해 애플리케이션을 구성할 수 있음
  - 컨테이너에 명령줄 인수 전달
  - 각 컨테이너를 위한 사용자 정의 환경변수 지정
  - 특수한 유형의 볼륨을 통해 설정 파일을 컨테이너에 마운트
- 이 중 민감한 정보(자격증명, 암호화키 등)은 시크릿(Secert) 오브젝트를 통해 설정하면 됨

## 2. 컨테이너에 명령줄 인자 전달

### 2.1 도커에서 명령어와 인자 정의

- 컨테이너에서 실행하는 명령은 명령어와 인자로 나뉨
- ENTRYPOINT: 컨테이너가 시작될 때 호출된 명령어를 정의
- CMD: ENTRYPOINT에 전달되는 인자를 정의
- shell과 exec 형식을 지원
  - shell: `ENTRYPOINT node app.js`
  - exec: `ENTRYPOINT ["node", "app.js"]`

> exec는 주어진 명령어를 실행하는데 새로운 프로세스를 생성하지 않고, 쉘 프로세스를 대체.
> 예를 들어 bash 쉘에서 자바 프로그램을 실행하면 자바 프로그램의 ppid가 bash 쉘이 되고, 자바 프로그램이 bash 쉘의 하위 프로세스로 실행. exec 커맨드로 실행하면 bash쉘의 프로세스가 자바 프로그램이 됨 (ppid 없음). 이후 자바프로그램이 종료되면 프로세스가 종료되며 bash 쉘로 돌아오지 않음.

